{% extends 'layout.html' %} {% block scripts %}
<script>
    function postContent() {
        let content = $("#my-content").val()
        let author = `{{g.user.user_id}}`

        $.ajax({
            url: '/post',
            type: 'post',
            data: {
                'content': content,
                'author': author
            },
            success: function (res) {
                let result = res['result']
                if (result == "success") {
                    window.location.reload()
                } else {
                    swal.fire("저장오류!", "내용을 다시한번 확인해주세요", "Error")
                }
            }
        })
    }

    function deletePost(id) {
        let author = `{{g.user.user_id}}`
        $.ajax({
            url: '/post',
            type: 'DELETE',
            data: {
                'id': id,
                'author': author
            },
            success: function (res) {
                if (res['result'] == 'success') {
                    swal.fire("삭제 성공!", "다른 게시글을 적어보세요", "Success")
                        .then(function () {
                            window.location.reload()
                        })
                }
            }
        })
    }

    function postUpdatePost(id) {
        let content = $(`#userEidContent${id}`).val()
        $.ajax({
            url: '/post',
            type: 'PATCH',
            data: {
                "id": id,
                "content": content
            },
            success: function (res) {
                if (res['result'] == 'success') {
                    swal.fire("수정 성공!", "", "Success")
                        .then(function () {
                            window.location.reload()
                        })
                }

            }
        })
    }

    function updatePost(id) {
        let content = $(`#userContent${id}`).text()
        let tmpHtml = `<textarea id=userEidContent${id} class="form-control" rows="3"></textarea>`
        let tmpBtn = `<button class="btn btn-sm btn-success" onclick="postUpdatePost(${id})">수정완료</button>`
        $("#edit-area").empty()
        $("#edit-area").append(tmpHtml)
        $(`#editBtn${id}`).hide()
        $(`#userEidContent${id}`).val(content)
        $("#edit-area").append(tmpBtn)

    }

    function postLike(id) {
        $.ajax({
            url: '/like',
            type: 'patch',
            data: {
                'id': id
            },
            success: function (res) {
                let result = res['result']
                if (result == "success") {
                    window.location.reload()
                } else {
                    alert("저장오류!")
                }
            }
        })
    }
</script>
{% endblock %} {% block content %}
<!-- yes/no container -->
<div class="container" style='height: 400px;'>
    <div class="row">
        <div class="col-sm-8">
            <br><img src='data:image/png;base64, {{ data }}'>

        </div>
        <div class="col-sm-4">
            데이터를 보고 마음 바뀐 사람의 총 수는 {{total[1]+total[2]}} 명입니다.<br>
            그중에서 데이터를 보고 상관관계를 찾으신 분은 {{total[2]}} 명이고, <br>
            데이터에 실망하신 분은 {{total[1]}} 명 입니다.
        </div>
    </div>
</div>
<!-- post container -->
<div class="container" style='width: 800px;'>
    <div class="row">
        <hr>
        <div class="card" style='border:none;'>
            <div class="card-body">
                <!-- <div class="mb-3"> -->
                <div class="input-box">
                    <input id='my-content' placeholder="느낀점을 다른사람과 공유해 보세요👍">
                    <label for="comment">"느낀점을 다른사람과 공유해 보세요👍"</label>
                </div>
                <!-- <input id='my-content' class="inp mb-3" placeholder="느낀점을 다른사람과 공유해 보세요👍">
                </div> -->
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button class="btn btn-secondary me-md-2" onclick="postContent()">댓글</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 댓글들 -->
{% for post in post_list %}
<div class="container" style="width: 800px;">
    <div class="row">
        <div class="col col-sm-10">
            <!-- <label class="form-label">{{post.author}}&nbsp;&nbsp;&nbsp;&nbsp;</label> -->
            <a style="font-size: large;">{{post.author}}&nbsp;&nbsp;&nbsp;&nbsp;</a>
            <a style="color:dimgray; font-size:small">{{(now - post.created_at).in_days()}} days ago</a>
            <div id='edit-area'>
                <p id='userContent{{post.id}}'>{{post.content}}</p>
                <button class="btn btn-sm btn-success"
                    onclick="postLike('{{post.id}}')">토글따봉버튼필요</button><span>&nbsp;&nbsp;&nbsp;&nbsp;{{post.like}}</span>
            </div>
        </div>
        <div class="col-sm-2" style='width:100px'>
            {%if post.author==g.user.user_id%}
            <div class="dropdown" style="border:None">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                    <li><a class="dropdown-item" onclick="deletePost('{{post.id}}')">Delete</a></li>
                    <li><a id='editBtn{{post.id}}' class="dropdown-item" onclick="updatePost('{{post.id}}')">Update</a></li>
                </ul>
              </div>
            {% endif %}
        </div>
    </div>
</div>
<div class="container" style="height: 20px;"></div>

{% endfor %}
</div>
{% endblock %}
