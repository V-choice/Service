{% extends 'layout.html' %} {% block scripts %}
<script>
    $(function() {
        $(".heart").on("click", function() {
            $(this).toggleClass("is-active");
        });
    });

    function postContent() {
        let content = $("#my-content").val()
        let author = `{{g.user.user_id}}`

        $.ajax({
            url: '/post',
            type: 'post',
            data: {
                'content': content,
                'author': author
            },
            success: function(res) {
                let result = res['result']
                if (result == "success") {
                    window.location.reload()
                } else {
                    swal.fire("저장오류!", "내용을 다시한번 확인해주세요", "Error")
                }
            }
        })
    }

    function deletePost(id) {
        let author = `{{g.user.user_id}}`
        $.ajax({
            url: '/post',
            type: 'DELETE',
            data: {
                'id': id,
                'author': author
            },
            success: function(res) {
                if (res['result'] == 'success') {
                    swal.fire("삭제 성공!", "다른 게시글을 적어보세요", "Success")
                        .then(function() {
                            window.location.reload()
                        })
                }
            }
        })
    }

    function postUpdatePost(id) {
        let content = $(`#userEidContent${id}`).val()
        $.ajax({
            url: '/post',
            type: 'PATCH',
            data: {
                "id": id,
                "content": content
            },
            success: function(res) {
                if (res['result'] == 'success') {
                    swal.fire("수정 성공!", "", "Success")
                        .then(function() {
                            window.location.reload()
                        })
                }

            }
        })
    }

    function updatePost(id) {
        let content = $(`#userContent${id}`).text()
        let tmpHtml = `<textarea id=userEidContent${id} class="form-control" rows="3"></textarea>`
        let tmpBtn = `<div class="d-grid gap-2 d-md-flex justify-content-md-end"><button class="btn btn-secondary me-md-2" onclick="postUpdatePost(${id})">Update</button></div>`
        $("#edit-area").empty()
        $("#edit-area").append(tmpHtml)
        $(`#editBtn${id}`).hide()
        $(`#userEidContent${id}`).val(content)
        $("#edit-area").append(tmpBtn)

    }

    function postLike(id) {
        $.ajax({
            url: '/like',
            type: 'patch',
            data: {
                'id': id
            },
            success: function(res) {
                let result = res['result']
                if (result == "success") {
                    window.location.reload()
                } else {
                    alert("저장오류!")
                }
            }
        })
    }
</script>
{% endblock %} {% block content %}
<!-- yes/no container -->
<div class="container-fluid row" style="width:100%">
    <div class="col-md-12 text-center">
        <br><img src='data:image/png;base64, {{ data }}' width="90%" height="auto">
    </div>
    <div class="col-md text-center">
        두 답변을 전부해주신 분은 <mark><strong>{{sum_total}}</strong></mark> 명 입니다.
        <br>데이터를 보고 yes에서 no로, no에서 yes로 답이 바뀐 사람은 총 <mark><strong>{{total[2]+total[1]}}</strong></mark> 명입니다.
        <br> 그중에서 no에서 yes로 답변이 바뀐 사람의 수는 <mark><strong>{{total[2]}}</strong></mark> 명이고,
        <br> yes를 했다가 no로 답을 바꾼 사람의 수는<mark><strong>{{total[1]}}</strong></mark> 명 입니다.
    </div>
</div>
<!-- post container -->
<div class="container-fluid" style='width: 800px;'>
    <div class="row">
        <div class="card" style='border:none;'>
            <div class="card-body">
                <!-- <div class="mb-3"> -->
                <div class="input-box">
                    <input id='my-content' placeholder="느낀점을 다른사람과 공유해 보세요👍">
                    <label for="comment">"느낀점을 다른사람과 공유해 보세요👍"</label>
                </div>
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button class="btn btn-secondary me-md-2" onclick="postContent()">댓글</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 댓글들 -->
{% for post in post_list %}
<div class="container-fluid" style="width: 800px;">
    <div class="row">
        <div class="col-sm-1">
            <img src="https://img.icons8.com/ios/50/000000/name.png" width="50" height="50" alt>
        </div>
        <div class="col col-sm-9">
            <!-- <label class="form-label">{{post.author}}&nbsp;&nbsp;&nbsp;&nbsp;</label> -->
            <a style="font-size: large;">{{post.author}}&nbsp;&nbsp;&nbsp;&nbsp;</a> {%if (now - post.created_at).in_hours() > 24 %}
            <a style="color:dimgray; font-size:small">{{(now - post.created_at).in_days()}} days ago</a> {% elif (now - post.created_at).in_minutes() > 60%}
            <a style="color:dimgray; font-size:small">{{(now - post.created_at).in_hours()}} hours ago</a> {% elif (now - post.created_at).in_seconds() > 60%}
            <a style="color:dimgray; font-size:small">{{(now - post.created_at).in_minutes()}} minutes ago</a> {%else%}
            <a style="color:dimgray; font-size:small">{{(now - post.created_at).in_seconds()}} seconds ago</a> {%endif %}
            <div id='edit-area'></div>
            <p id='userContent{{post.id}}'>{{post.content}}</p>
            <button class="btn btn-sm btn-light" onclick="postLike('{{post.id}}')"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-hand-thumbs-up" viewBox="0 0 16 16">
                <path d="M8.864.046C7.908-.193 7.02.53 6.956 1.466c-.072 1.051-.23 2.016-.428 2.59-.125.36-.479 1.013-1.04 1.639-.557.623-1.282 1.178-2.131 1.41C2.685 7.288 2 7.87 2 8.72v4.001c0 .845.682 1.464 1.448 1.545 1.07.114 1.564.415 2.068.723l.048.03c.272.165.578.348.97.484.397.136.861.217 1.466.217h3.5c.937 0 1.599-.477 1.934-1.064a1.86 1.86 0 0 0 .254-.912c0-.152-.023-.312-.077-.464.201-.263.38-.578.488-.901.11-.33.172-.762.004-1.149.069-.13.12-.269.159-.403.077-.27.113-.568.113-.857 0-.288-.036-.585-.113-.856a2.144 2.144 0 0 0-.138-.362 1.9 1.9 0 0 0 .234-1.734c-.206-.592-.682-1.1-1.2-1.272-.847-.282-1.803-.276-2.516-.211a9.84 9.84 0 0 0-.443.05 9.365 9.365 0 0 0-.062-4.509A1.38 1.38 0 0 0 9.125.111L8.864.046zM11.5 14.721H8c-.51 0-.863-.069-1.14-.164-.281-.097-.506-.228-.776-.393l-.04-.024c-.555-.339-1.198-.731-2.49-.868-.333-.036-.554-.29-.554-.55V8.72c0-.254.226-.543.62-.65 1.095-.3 1.977-.996 2.614-1.708.635-.71 1.064-1.475 1.238-1.978.243-.7.407-1.768.482-2.85.025-.362.36-.594.667-.518l.262.066c.16.04.258.143.288.255a8.34 8.34 0 0 1-.145 4.725.5.5 0 0 0 .595.644l.003-.001.014-.003.058-.014a8.908 8.908 0 0 1 1.036-.157c.663-.06 1.457-.054 2.11.164.175.058.45.3.57.65.107.308.087.67-.266 1.022l-.353.353.353.354c.043.043.105.141.154.315.048.167.075.37.075.581 0 .212-.027.414-.075.582-.05.174-.111.272-.154.315l-.353.353.353.354c.047.047.109.177.005.488a2.224 2.224 0 0 1-.505.805l-.353.353.353.354c.006.005.041.05.041.17a.866.866 0 0 1-.121.416c-.165.288-.503.56-1.066.56z"/></svg></button>
            <span>&nbsp;&nbsp;&nbsp;&nbsp;{{post.like}}</span></div>
        <div class="col-sm-2" style='width:100px'>
            {%if post.author==g.user.user_id%}
            <div class="dropdown" style="border:None">
                <button class="btn btn-light dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                    <li><a class="dropdown-item" onclick="deletePost('{{post.id}}')">Delete</a></li>
                    <li><a id='editBtn{{post.id}}' class="dropdown-item" onclick="updatePost('{{post.id}}')">Update</a></li>
                </ul>
            </div>
            {% endif %}
        </div>
    </div>
</div>
<div class="container" style="height: 20px;"></div>

{% endfor %}
</div>
{% endblock %}