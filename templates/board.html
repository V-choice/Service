{% extends 'layout.html' %} {% block scripts %}
<script>
    function postContent() {
        let content = $("#my-content").val()
        let author = `{{g.user.user_id}}`

        $.ajax({
            url: '/post',
            type: 'post',
            data: {
                'content': content,
                'author': author
            },
            success: function (res) {
                let result = res['result']
                if (result == "success") {
                    window.location.reload()
                } else {
                    swal.fire("ì €ì¥ì˜¤ë¥˜!", "ë‚´ìš©ì„ ë‹¤ì‹œí•œë²ˆ í™•ì¸í•´ì£¼ì„¸ìš”", "Error")
                }
            }
        })
    }

    function deletePost(id) {
        let author = `{{g.user.user_id}}`
        $.ajax({
            url: '/post',
            type: 'DELETE',
            data: {
                'id': id,
                'author': author
            },
            success: function (res) {
                if (res['result'] == 'success') {
                    swal.fire("ì‚­ì œ ì„±ê³µ!", "ë‹¤ë¥¸ ê²Œì‹œê¸€ì„ ì ì–´ë³´ì„¸ìš”", "Success")
                        .then(function () {
                            window.location.reload()
                        })
                }
            }
        })
    }

    function postUpdatePost(id) {
        let content = $(`#userEidContent${id}`).val()
        $.ajax({
            url: '/post',
            type: 'PATCH',
            data: {
                "id": id,
                "content": content
            },
            success: function (res) {
                if (res['result'] == 'success') {
                    swal.fire("ìˆ˜ì • ì„±ê³µ!", "", "Success")
                        .then(function () {
                            window.location.reload()
                        })
                }

            }
        })
    }

    function updatePost(id) {
        let content = $(`#userContent${id}`).text()
        let tmpHtml = `<textarea id=userEidContent${id} class="form-control" rows="3"></textarea>`
        let tmpBtn = `<button class="btn btn-sm btn-success" onclick="postUpdatePost(${id})">ìˆ˜ì •ì™„ë£Œ</button>`
        $("#edit-area").empty()
        $("#edit-area").append(tmpHtml)
        $(`#editBtn${id}`).hide()
        $(`#userEidContent${id}`).val(content)
        $("#edit-area").append(tmpBtn)

    }

    function postLike(id) {
        $.ajax({
            url: '/like',
            type: 'patch',
            data: {
                'id': id
            },
            success: function (res) {
                let result = res['result']
                if (result == "success") {
                    window.location.reload()
                } else {
                    alert("ì €ì¥ì˜¤ë¥˜!")
                }
            }
        })
    }
</script>
{% endblock %} {% block content %}
<!-- yes/no container -->
<div class="container" style='height: 400px;'>
    <div class="row">
        <div class="col-sm-8">
            <br><img src='data:image/png;base64, {{ data }}'>

        </div>
        <div class="col-sm-4">
            ë°ì´í„°ë¥¼ ë³´ê³  ë§ˆìŒ ë°”ë€ ì‚¬ëŒì˜ ì´ ìˆ˜ëŠ” {{total[1]+total[2]}} ëª…ì…ë‹ˆë‹¤.<br>
            ê·¸ì¤‘ì—ì„œ ë°ì´í„°ë¥¼ ë³´ê³  ìƒê´€ê´€ê³„ë¥¼ ì°¾ìœ¼ì‹  ë¶„ì€ {{total[2]}} ëª…ì´ê³ , <br>
            ë°ì´í„°ì— ì‹¤ë§í•˜ì‹  ë¶„ì€ {{total[1]}} ëª… ì…ë‹ˆë‹¤.
        </div>
    </div>
</div>
<!-- post container -->
<div class="container" style='width: 800px;'>
    <div class="row">
        <hr>
        <div class="card" style='border:none;'>
            <div class="card-body">
                <!-- <div class="mb-3"> -->
                <div class="input-box">
                    <input id='my-content' placeholder="ëŠë‚€ì ì„ ë‹¤ë¥¸ì‚¬ëŒê³¼ ê³µìœ í•´ ë³´ì„¸ìš”ğŸ‘">
                    <label for="comment">"ëŠë‚€ì ì„ ë‹¤ë¥¸ì‚¬ëŒê³¼ ê³µìœ í•´ ë³´ì„¸ìš”ğŸ‘"</label>
                </div>
                <!-- <input id='my-content' class="inp mb-3" placeholder="ëŠë‚€ì ì„ ë‹¤ë¥¸ì‚¬ëŒê³¼ ê³µìœ í•´ ë³´ì„¸ìš”ğŸ‘">
                </div> -->
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button class="btn btn-secondary me-md-2" onclick="postContent()">ëŒ“ê¸€</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- ëŒ“ê¸€ë“¤ -->
{% for post in post_list %}
<div class="container" style="width: 800px;">
    <div class="row">
        <div class="col col-sm-10">
            <!-- <label class="form-label">{{post.author}}&nbsp;&nbsp;&nbsp;&nbsp;</label> -->
            <a style="font-size: large;">{{post.author}}&nbsp;&nbsp;&nbsp;&nbsp;</a>
            <a style="color:dimgray; font-size:small">{{(now - post.created_at).in_days()}} days ago</a>
            <div id='edit-area'>
                <p id='userContent{{post.id}}'>{{post.content}}</p>
                <button class="btn btn-sm btn-success"
                    onclick="postLike('{{post.id}}')">í† ê¸€ë”°ë´‰ë²„íŠ¼í•„ìš”</button><span>&nbsp;&nbsp;&nbsp;&nbsp;{{post.like}}</span>
            </div>
        </div>
        <div class="col-sm-2" style='width:100px'>
            {%if post.author==g.user.user_id%}
            <div class="dropdown" style="border:None">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                    <li><a class="dropdown-item" onclick="deletePost('{{post.id}}')">Delete</a></li>
                    <li><a id='editBtn{{post.id}}' class="dropdown-item" onclick="updatePost('{{post.id}}')">Update</a></li>
                </ul>
              </div>
            {% endif %}
        </div>
    </div>
</div>
<div class="container" style="height: 20px;"></div>

{% endfor %}
</div>
{% endblock %}
