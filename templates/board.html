{% extends 'layout.html' %} {% block scripts %}
<script>
    function postContent() {
        let content = $("#my-content").val()
        let author = `{{g.user.user_id}}`

        $.ajax({
            url: '/post',
            type: 'post',
            data: {
                'content': content,
                'author': author
            },
            success: function(res) {
                let result = res['result']
                if (result == "success") {
                    window.location.reload()
                } else {
                    swal.fire("ì €ì¥ì˜¤ë¥˜!", "ë‚´ìš©ì„ ë‹¤ì‹œí•œë²ˆ í™•ì¸í•´ì£¼ì„¸ìš”", "Error")
                }
            }
        })
    }

    function deletePost(id) {
        let author = `{{g.user.user_id}}`
        $.ajax({
            url: '/post',
            type: 'DELETE',
            data: {
                'id': id,
                'author': author
            },
            success: function(res) {
                if (res['result'] == 'success') {
                    swal.fire("ì‚­ì œ ì„±ê³µ!", "ë‹¤ë¥¸ ê²Œì‹œê¸€ì„ ì ì–´ë³´ì„¸ìš”", "Success")
                        .then(function() {
                            window.location.reload()
                        })
                }
            }
        })
    }

    function postUpdatePost(id) {
        let content = $(`#userEidContent${id}`).val()
        $.ajax({
            url: '/post',
            type: 'PATCH',
            data: {
                "id": id,
                "content": content
            },
            success: function(res) {
                if (res['result'] == 'success') {
                    swal.fire("ìˆ˜ì • ì„±ê³µ!", "", "Success")
                        .then(function() {
                            window.location.reload()
                        })
                }

            }
        })
    }

    function updatePost(id) {
        let content = $(`#userContent${id}`).text()
        let tmpHtml = `<textarea id=userEidContent${id} class="form-control" rows="3"></textarea>`
        let tmpBtn = `<button class="btn btn-sm btn-success" onclick="postUpdatePost(${id})">ìˆ˜ì •ì™„ë£Œ</button>`
        $("#edit-area").empty()
        $("#edit-area").append(tmpHtml)
        $(`#editBtn${id}`).hide()
        $(`#userEidContent${id}`).val(content)
        $("#edit-area").append(tmpBtn)

    }
</script>
{% endblock %} {% block content %}
<!-- yes/no container -->
<div class="container" style='height: 400px;'>
    <div class="row">
        <div class="col-sm-8">
            yes/no graph<br> first_yes{{first_yes}}
            <br> first_no{{first_no}}
            <br> second_yes{{second_yes}}
            <br> second_no{{second_no}}
            <br>

        </div>
        <div class="col-sm-4">
            í†µê³„ ë§ë¡œ ì„¤ëª…
        </div>
    </div>
</div>
<!-- post container -->
<div class="container" style='width: 800px;'>
    <div class="row">
        <hr>
        <div class="card" style='border:none;'>
            <div class="card-body">
                <!-- <div class="mb-3"> -->
                <div class="input-box">
                    <input id='my-content' placeholder="ëŠë‚€ì ì„ ë‹¤ë¥¸ì‚¬ëŒê³¼ ê³µìœ í•´ ë³´ì„¸ìš”ğŸ‘">
                    <label for="comment">"ëŠë‚€ì ì„ ë‹¤ë¥¸ì‚¬ëŒê³¼ ê³µìœ í•´ ë³´ì„¸ìš”ğŸ‘"</label>
                </div>
                <!-- <input id='my-content' class="inp mb-3" placeholder="ëŠë‚€ì ì„ ë‹¤ë¥¸ì‚¬ëŒê³¼ ê³µìœ í•´ ë³´ì„¸ìš”ğŸ‘">
                </div> -->
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button class="btn btn-secondary me-md-2" onclick="postContent()">ëŒ“ê¸€</button>
                </div>
            </div>
        </div>
        <hr> {% for post in post_list %}

        <div class="card mt-2" style='border:none;'>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label">{{post.author}}&nbsp;&nbsp;&nbsp;&nbsp;</label>
                    <a>{{now - post.created_at}} ago</a>
                    <div id='edit-area'>
                        <p id='userContent{{post.id}}'>{{post.content}}</p>
                    </div>
                </div>
                <div class="card-footer text-muted">
                    <span>ì¢‹ì•„ìš” {{post.like}} ê°œ</span>
                    <button class="btn btn-sm btn-success" onclick="postLike('{{post.id}}')">ì¢‹ì•„ìš”</button>
                </div>
                {%if post.author==g.user.user_id%}
                <div class="card-footer text-muted">
                    <button class="btn btn-sm btn-warning" onclick="deletePost('{{post.id}}')">ì‚­ì œí•˜ê¸°</button>
                    <button id='editBtn{{post.id}}' class="btn btn-sm btn-success" onclick="updatePost('{{post.id}}')">ìˆ˜ì •í•˜ê¸°</button>
                </div>
                {% endif %}
            </div>

            {% endfor %}
        </div>
    </div>
    {% endblock %}